# Codemod: Split Barrel Imports

This codemod helps eliminate barrel file imports by replacing them with direct per-file imports. It includes two main scripts:

---

## 1. `list-barrel-exports.mjs`

Generates a JSON file that maps exported symbols to their source files.

### Usage

```bash
node ./bin/list-barrel-exports.mjs <utilsDir> > exports-map.json
```

- `<utilsDir>`: Directory where the barrel file exists and where exports are located.

### Example

```bash
node ./bin/list-barrel-exports.mjs apps/webapp/src/js/includes/common/utils > exports-map.json
```

---

## 2. `split-utils-imports.mjs`

Transforms the source files by splitting named imports from barrel files into per-file imports.

### Usage

```bash
node ./bin/split-utils-imports.mjs <srcDir> <exportsMap> [--basePath path] [--alias alias=realpath] [--exclude symbol1,symbol2,...]
```

### Arguments

- `<srcDir>`: Directory to recursively scan and transform.
- `<exportsMap>`: Path to the JSON file generated by `list-barrel-exports.mjs`.

#### Optional flags

- `--basePath <path>`: Root path for resolving files. Defaults to `<srcDir>`.
- `--alias alias=path`: Specify module aliases (can be repeated).  
  Example: `--alias utils=apps/webapp/src/js/includes/common/utils`
- `--exclude symbol1,symbol2,...`: Comma-separated list of symbols to keep in the original import and not split.

### Example

```bash
node ./bin/split-utils-imports.mjs \
  apps/webapp/src/js/includes/common/utils \
  ./exports-map.json \
  --basePath apps/webapp/src \
  --alias utils=apps/webapp/src/js/includes/common/utils \
  --exclude foo,bar
```

---

## Running Tests

This project uses [Node.js Test Runner](https://nodejs.org/api/test.html) built-in with Node 20+.

### Run all tests

```bash
npm test
```

This runs:

```bash
node --test
```

---

## Node Version

This project includes an `.nvmrc` file to define the required Node.js version. Use [nvm](https://github.com/nvm-sh/nvm) to automatically switch:

```bash
nvm use
```
